<!--
  ~ Copyright (c) 2019 created by Hubert Formin
  -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Electron-pos-printer</title>
    <style>
        @page {
            margin: 0;
        }
        body {
            font-size: 12px;
            /*line-height: 24px;*/
        }
        .font {font-size: 12px; margin: 0 20px 0 0;}
    </style>
</head>
<body>
<section id="main"></section>
<script src="libs/jsbarcode.min.js"></script>
<script src="libs/qrcode.min.js"></script>
<script src="libs/jquery.min.js"></script>
<script>
    const ipcRender = require('electron').ipcRenderer;
    const body = $('#main');
    let barcodeNumber = 0;
    ipcRender.on('print-body-init', function (event, arg) {
        /*let css = arg.css;
        if (css) {
            for (const key in css) {
                const item = css[key];
                body.css(key, item);
            }
        }*/
        body.css('width:' + arg.width + 'margin:' + arg.margin);
        event.sender.send('print-body-init-reply', arg);
    });

    ipcRender.on('print-text', function (event, arg) {
        const text = arg.value;
        const css = arg.css;
        const div = $(`<div class="font" style="${arg.style}">${text}</div>`);
        if (css) {
            for (const key in css) {
                const item = css[key];
                div.css(key, item);
            }
        }
        body.append(div);
        event.sender.send('print-text-reply', arg);
    });

    ipcRender.on('print-qrCode', function (event, arg) {
        body.append(`<div id="qrCode${barcodeNumber}" style="${arg.style}"></div>`);
        new QRCode(document.getElementById(`qrCode${barcodeNumber}`), {
            text: arg.value,
            width: arg.width ? arg.width : 1,
            height: arg.height ? arg.height : 15,
            colorDark: '#000000',
            colorLight: '#ffffff',
            correctLevel: QRCode.CorrectLevel.H
        });
        // $(`#qrcode${barcodeNumber}`).attr('style',arg.style);
        barcodeNumber++;
        event.sender.send('print-qrCode-reply', arg);
    });

    ipcRender.on('print-barCode', function (event, arg) {
        body.append(`<img class="barCode${barcodeNumber}"  style="${arg.style}"
        jsbarcode-value="${arg.value}"
        jsbarcode-width="${arg.width ? arg.width : 1}"
        jsbarcode-height="${arg.height ? arg.height : 15}"
        jsbarcode-fontsize="${arg.fontsize ? arg.fontsize : 12}"
        jsbarcode-margin="0"
        jsbarcode-displayvalue="${!!arg.displayValue}"/>`);
        JsBarcode(`.barCode${barcodeNumber}`).init();
        barcodeNumber++;
        event.sender.send('print-barCode-reply', arg);
    })
</script>
</body>
</html>
